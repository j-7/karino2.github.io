---
title: "確率的プログラミングをかじるべく、dipplのサイトを見る"
date: 2018-01-04 17:16:39
---

個人的にはまだやらんでもいいかなぁ、と思ってた確率的プログラミングだが、マストドンの若者に「なんすか？それ」と聞かれたので、答えられるくらいは知っとこうかなぁ、という気になる。

すると、nsharp_2ch氏に、[dipplのサイト](http://dippl.org/)が一番入門には良いよ、と教えてもらったので、これを軽く読んでいく。

## The WebPPL language

introはまぁいいだろう。で、次の

http://dippl.org/chapters/02-webppl.html

を読む。
分布のprimitiveとしてはsampleとscoreらしい。
なんかこれでabsサーチみたいな事やるのかなぁ。

自分は昔PGMのコースでOctave で離散の確率モデルをいろいろするような処理系を書く、という課題を結構真面目に解いたので、やってる事は結構似ている気がする。

とりあえず先に進まないと詳細はわからなかろう、と軽く読み進めると、最後のfactorの所は良く分からない。
factorの中をcと足すんじゃ何が駄目なんだろう？

良く分からないが先に進む。

## Exploring a random computation

なんな次はCPSの話が続くが、いまいちモチベーションが分からないのでなんの話をしているかわからなくなる。

まずsampleの正体が知りたいと思うのだが。

とりあえずcpsBinominalまで読む。
これってcpsSampleを適切に実装してやれば、どんどんサンプリングを出来ますよ、という話かね。

### Coroutines

この_sampleは何をしているのか？
supportは同時確率の事か？

良く分からないが、とりあえず分布に従った値を返すジェネレータと思っておこう。

unexploredFuturesというのに、サンプルされた値を継続に渡して呼ぶ関数をひたすらプッシュしている訳だよな。

supportがどういう実装なのかがいまいち分からないが、ここからpopしてそれをコールすると一回sample を呼んだ時点のcontinuationで一回サンプリングされた値が呼ばれる訳だな。

このunexploredFuturesはどこで呼ぶのだろうか？

exitで呼んてるな。

supportのところは良く分からないが、読み進めてみよう。

値が実現する確率はlog確率の和を取って最後にexpしている。
これでマージナライズが実装出来るのは以前PGMの授業でOctaveで実装した通りだな。

この辺はa, b, cのテーブル見ながら議論する方が分かりやすいと思うのだけど、それを既に終えているという前提なのかねぇ。こりゃ大変やね。

### Continuation-passing transform

ここは何を言いたいのかさっぱり分からんな。
コードをパースしてどうCPSスタイルに直すか、という話をしているのかしら？

なんかリンクがあるのでリンク先読むか。

### How to compile with continuations

http://matt.might.net/articles/cps-conversion/

なんかschemeでコンパイラ書く、みたいな話だな。昔こういうの見た事ある気がする。

さて、MとTを見る事から始めよう。
Mはラムダの時にkを足すのとbody をTする、それ以外の場合はそのまま引数を返す。
ラムダ式も形は変われどラムダ式なので、CPSの世界での値としてそのまま値が返るイメージだよな。

Tはトランスフォームだろうが、何をするのか。
再帰的な構造になってて、引数がラムダ式かシンボルならcontにMして渡す。
Mはまぁそのまま返すようなものなので、ようするにcontに引数を渡すだけだ。

で、引数がリストの場合はcarとcdrを別々にTして、contの先で渡ってきたf, eを使ってコールしている。
この辺はモナドレベルが大分上がった今見るとどうという事は無いな。

carがf, cdrがeで、それぞれをTの第一引数にする、というのは、再帰の底では結局Mしてcont呼ぶ訳だよな。
で、このcontは今作ってるラムダで、それは渡されてきた物をコールする訳だ。
つまりMした物をコールする訳だね。

少しややこしいが、ぐっとにらめばぱっと分かるレベル。

そのままhigher-order transformまで一応読んだが、この先は要らなさそうな気がするのでひとまず戻る。

### Continuation-passing transformに戻る

さて、戻ってきてみると、CpsTransformはTの事を言っている事が分かる。
なんだ、そうならそうと最初から言ってくれよ。

まぁJSで説明しようという試みなのでこういう所が出てきてしまうのだろうなぁ。

その後の変換が試せる奴で中間変数とか作ったりするとなんかバグってるんだが…まぁ見なかった事にして先に進もう。

### Best-first enumeration

ここまでは単にコンパイラの教科書の復習みたいな内容だったが、突然確率的プログラミングっぽくなってきた。

なるほど。

で、サンプルのEumerateメソッドの引数を1, 2, 3と変えてみろ、と書いてあるがEnumerate メソッドなんて無いんだが…あぁ、maxExecutions の事か。

ただこの3つの例の意味は全然分からないな。

しばらく数字を変えてたがさっぱり分からん。ちょっとこの例では分かりようが無い気がするのでとりあえず先に進もう。
